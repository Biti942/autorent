<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>AutoRent - Dashboard Premium</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
  <script src="js/firebase.js"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: #0f172a;
      color: #fff;
      padding: 20px;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      margin-bottom: 30px;
    }

    h1 {
      font-size: 1.8rem;
      color: #38bdf8;
      margin: 0;
    }

    .user-info {
      text-align: right;
      font-size: 0.9rem;
    }

    .user-info span {
      color: #facc15;
    }

    .logout-btn {
      background-color: #ef4444;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      margin-top: 8px;
      cursor: pointer;
    }

    .form-section {
      background-color: #1e293b;
      padding: 25px;
      border-radius: 12px;
      max-width: 800px;
      margin: auto;
    }

    .form-section h2 {
      margin-bottom: 20px;
      color: #4ade80;
    }

    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
    }

    input, textarea {
      width: 100%;
      padding: 12px;
      margin-bottom: 15px;
      border-radius: 8px;
      border: none;
      font-size: 1rem;
    }

    .available-switch {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
    }

    .available-switch input {
      margin-right: 10px;
    }

    .btn {
      background-color: #38bdf8;
      border: none;
      color: #0f172a;
      padding: 12px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }

    .btn:hover {
      background-color: #0ea5e9;
    }

    .navigation {
      text-align: center;
      margin-top: 40px;
    }

    .navigation a {
      color: #facc15;
      text-decoration: none;
      font-weight: bold;
    }
  </style>
</head>
<body>

<header>
  <h1>üéØ Dashboard Premium - AutoRent</h1>
  <div class="user-info">
    <p>Connect√© en tant que : <span id="user-email"></span></p>
    <button class="logout-btn" id="logoutBtn">Se d√©connecter</button>
  </div>
</header>

<div class="form-section">
  <h2>‚ûï Ajouter une nouvelle voiture</h2>
  <form>
    <label for="name">Nom de la voiture</label>
    <input type="text" id="name" placeholder="ex: Dacia Logan 2022">

    <label for="image">Image de la voiture</label>
    <input type="file" id="image">

    <label for="price">Prix par jour (en MAD)</label>
    <input type="number" id="price" placeholder="ex: 250">

    <label for="desc">Description</label>
    <textarea id="desc" rows="4" placeholder="Description auto ou g√©n√©r√©e..."></textarea>

    <div class="available-switch">
      <input type="checkbox" id="available">
      <label for="available">Disponible</label>
    </div>

    <button type="submit" class="btn">Ajouter la voiture</button>
  </form>
</div>

<div class="navigation">
  <p>üìä G√©rer l‚Äô√©tat de vos voitures : <a href="gerance-premium.html">G√©rance Premium</a></p>
  <p style="margin-top: 10px;">üßë‚Äçüíª Voir votre site vitrine : <a href="site-agent.html">Mon site</a></p>
</div>

<!-- Script de gestion -->
<script>
  const auth = firebase.auth();
  const db = firebase.firestore();
  const form = document.querySelector("form");
  const imageInput = document.getElementById("image");

  function genererDescriptionAuto(nom, prix, disponible) {
    const marque = nom.split(" ")[0] || "Cette voiture";
    const dispoTxt = disponible ? "disponible imm√©diatement" : "actuellement non disponible";
    return `${marque} offre un excellent rapport qualit√©/prix √† seulement ${prix} DH/jour. Elle est ${dispoTxt} et parfaitement adapt√©e aux trajets urbains comme aux longues distances.`;
  }

  auth.onAuthStateChanged(function(user) {
    if (!user) {
      window.location.href = "connexion.html";
    } else {
      document.getElementById("user-email").textContent = user.email;
      document.getElementById("logoutBtn").addEventListener("click", () => {
        auth.signOut().then(() => {
          window.location.href = "connexion.html";
        });
      });

      const uid = user.uid;

      form.addEventListener("submit", async function(e) {
        e.preventDefault();

        const nom = document.getElementById("name").value.trim();
        const prix = parseFloat(document.getElementById("price").value.trim());
        const descInput = document.getElementById("desc").value.trim();
        const disponible = document.getElementById("available").checked;
        const file = imageInput.files[0];

        if (!file || !nom || isNaN(prix)) {
          alert("Remplis tous les champs et ajoute une image.");
          return;
        }

        const descriptionFinale = descInput || genererDescriptionAuto(nom, prix, disponible);

        const reader = new FileReader();
        reader.onloadend = function() {
          const imageUrl = reader.result;

          db.collection("cars").add({
            uid,
            nom,
            prix,
            description: descriptionFinale,
            imageUrl,
            disponible,
            vidange: "-",
            reservation: "-",
            retour: "-",
            kilometrage: "-",
            credit: "-",
            depenses: "-",
            ca: "-"
          }).then(() => {
            alert("üöó Voiture ajout√©e avec succ√®s !");
            form.reset();
          }).catch((err) => {
            console.error("Erreur :", err);
            alert("Erreur lors de l‚Äôajout.");
          });
        };
        reader.readAsDataURL(file);
      });
    }
  });
</script>

</body>
</html>


